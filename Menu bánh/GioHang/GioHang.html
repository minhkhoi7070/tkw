<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng & Thanh to√°n</title>

    <link rel="stylesheet" href="/Home Page/css/HomePage.css">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

    <style>
        body {
            background-color: #f9f9f9;
            font-family: Arial, sans-serif;
            color: #333;
        }

        .main-container {
            max-width: 1200px;
            margin: 40px auto;
            background-color: #fff;
            padding: 0;
            border-radius: 0;
            border: 1px solid #e0e0e0;
        }

        /* --- Thanh B∆∞·ªõc (Steps) --- */
        .checkout-steps-wrapper {
            background-color: #f7f7f7;
            padding: 20px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .checkout-steps {
            list-style: none;
            display: flex;
            justify-content: center;
            padding: 0;
            margin: 0;
        }

            .checkout-steps li {
                position: relative;
                padding: 0 30px;
                color: #aaa;
                font-weight: 500;
                font-size: 0.9rem;
            }

                .checkout-steps li:after {
                    content: ">";
                    position: absolute;
                    right: -10px;
                    top: 2px;
                    color: #ccc;
                    font-size: 1.2rem;
                }

                .checkout-steps li:last-child:after {
                    content: none;
                }

            .checkout-steps .step-number {
                background-color: #ccc;
                color: #fff;
                margin-right: 8px;
                display: inline-block;
                width: 28px;
                height: 28px;
                line-height: 28px;
                text-align: center;
                border-radius: 50%;
                font-weight: bold;
            }

            .checkout-steps .active .step-number {
                background-color: #e67e22; /* M√†u cam */
            }

            .checkout-steps .active {
                color: #333;
                font-weight: bold;
            }

            .checkout-steps .completed .step-number {
                background-color: #27ae60; /* M√†u xanh l√° */
            }

            .checkout-steps .completed {
                color: #27ae60;
            }

        /* --- L·ªõp b·ªçc n·ªôi dung 3 b∆∞·ªõc --- */
        .page-content-wrapper {
            padding: 40px;
        }

        /* --- N√∫t chung --- */
        .btn-primary-custom {
            background-color: #f59518;
            border-color: #f59518;
            color: #fff;
            font-weight: bold;
            padding: 12px;
            width: 100%;
            text-transform: uppercase;
        }

            .btn-primary-custom:hover {
                background-color: #e67e22;
                border-color: #e67e22;
                color: #fff;
            }

        .btn-danger-custom {
            background-color: #e74c3c;
            border-color: #e74c3c;
            color: #fff;
            font-weight: bold;
            padding: 12px;
            width: 100%;
            text-transform: uppercase;
        }

            .btn-danger-custom:hover {
                background-color: #c0392b;
                border-color: #c0392b;
                color: #fff;
            }

        .btn-secondary-custom {
            background-color: #e0e0e0;
            border-color: #e0e0e0;
            color: #555;
            font-weight: bold;
        }

        /* --- Trang Gi·ªè h√†ng (Step 1) --- */
        #cart-page .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            margin-right: 15px;
            border-radius: 4px;
        }

        #cart-page .product-name {
            font-weight: bold;
        }

        #cart-page .quantity-control-v2 {
            display: flex;
            max-width: 120px;
        }

            #cart-page .quantity-control-v2 .btn {
                width: 35px;
                font-weight: bold;
            }

            #cart-page .quantity-control-v2 .quantity-input {
                text-align: center;
                border-left: 0;
                border-right: 0;
                border-radius: 0;
                pointer-events: none;
                background: #fff;
            }

        #cart-page .remove-btn {
            font-size: 1.8rem;
            color: #aaa;
            cursor: pointer;
        }

            #cart-page .remove-btn:hover {
                color: #e74c3c;
            }

        #cart-page .cart-summary-box {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            padding: 25px;
            border-radius: 4px;
        }

            #cart-page .cart-summary-box h3 {
                font-size: 1.5rem;
                font-weight: bold;
                border-bottom: 1px solid #e0e0e0;
                padding-bottom: 15px;
                margin-bottom: 20px;
            }

        #cart-page .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 1rem;
        }

            #cart-page .summary-row span:last-child {
                font-weight: bold;
            }

            #cart-page .summary-row.total-row {
                font-size: 1.3rem;
                font-weight: bold;
                color: #e74c3c;
                border-top: 1px solid #e0e0e0;
                padding-top: 15px;
            }

        /* --- Trang Thanh to√°n (Step 2) --- */
        .checkout-promo-banner {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

            .checkout-promo-banner input {
                max-width: 300px;
                margin-left: auto;
                margin-right: 15px;
            }

        #checkout-page h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 25px;
        }

        /* === ƒê√É S·ª¨A PADDING CHO FORM === */
        #checkout-page .form-control {
            border-radius: 0;
            padding: 12px 15px; /* Gi·∫£m padding ƒë·ªÉ ch·ªØ hi·ªÉn th·ªã */
            height: auto; /* Th√™m d√≤ng n√†y ƒë·ªÉ t∆∞∆°ng th√≠ch */
        }

        #checkout-page .order-summary-box {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            padding: 25px;
            border-radius: 4px;
        }

            #checkout-page .order-summary-box table {
                width: 100%;
                font-size: 0.9rem;
            }

            #checkout-page .order-summary-box td {
                padding: 10px 0;
                border-bottom: 1px solid #e0e0e0;
            }

            #checkout-page .order-summary-box .product-name {
                color: #555;
            }

                #checkout-page .order-summary-box .product-name span {
                    color: #aaa;
                }

            #checkout-page .order-summary-box tfoot td {
                font-weight: bold;
            }

            #checkout-page .order-summary-box .total-row td {
                font-size: 1.3rem;
                color: #e74c3c;
            }

        #checkout-page .payment-method {
            border: 1px solid #e0e0e0;
            padding: 15px;
            border-radius: 4px;
            background: #fff;
        }

            #checkout-page .payment-method.active {
                border-color: #e67e22;
                box-shadow: 0 0 5px rgba(230,126,34,0.5);
            }

        #checkout-page .payment-method-details {
            font-size: 0.9rem;
            color: #777;
            margin-top: 10px;
            padding-left: 30px;
        }

        /* --- Trang X√°c nh·∫≠n (Step 3) --- */
        #order-confirmation-page h2 {
            font-weight: bold;
            color: #27ae60;
        }

        #order-confirmation-page .order-summary-box {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            padding: 25px;
            border-radius: 4px;
        }

            #order-confirmation-page .order-summary-box table {
                width: 100%;
            }

            #order-confirmation-page .order-summary-box td {
                padding: 10px 0;
                border-bottom: 1px solid #e0e0e0;
            }

            #order-confirmation-page .order-summary-box tfoot td {
                font-weight: bold;
            }

            #order-confirmation-page .order-summary-box .total-row td {
                font-size: 1.3rem;
                color: #e74c3c;
            }

        /* === CSS M·ªöI CHO H·ªòP VOUCHER === */
        .voucher-list-box {
            background-color: #fffaf0; /* M√†u n·ªÅn v√†ng nh·∫°t */
            border: 1px dashed #e67e22; /* Vi·ªÅn cam ƒë·ª©t n√©t */
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 4px;
        }

            .voucher-list-box h5 {
                font-weight: bold;
                font-size: 1.1rem;
                color: #e67e22; /* M√†u cam */
                margin-bottom: 15px;
            }

        .voucher-item {
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        /* D√πng class 'badge' c·ªßa Bootstrap v√† t√πy ch·ªânh th√™m */
        .voucher-code {
            background-color: #e67e22;
            color: white;
            padding: 6px 10px;
            font-size: 0.9rem;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer; /* Bi·∫øn th√†nh con tr·ªè tay */
            transition: background-color 0.2s;
        }

            .voucher-code:hover {
                background-color: #c0392b; /* ƒê·ªïi m√†u khi hover */
            }

        .voucher-condition {
            color: #333;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <script src="/JavaScript/global.js"></script>
    </head>
    <body>
        <header>
            <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
                <div class="container">
                    <a class="navbar-brand" href="/Home Page/src/HomePage.html">
                        <img src="../img/logo.png" alt="Logo Sweetie Cake">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="main-menu">
                        <ul class="navbar-nav ml-auto align-items-center">

                            <li class="nav-item ">
                                <a class="nav-link" href="/Home Page/src/HomePage.html">Trang ch·ªß</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle " href="/Menu b√°nh/html/Menu.html" id="navbarDropdownMenuLink" aria-haspopup="true" aria-expanded="false">
                                    Menu B√°nh
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">

                                    <a class="dropdown-item" href="/Menu b√°nh/html/sweetbox.html">Sweetbox</a>
                                    <a class="dropdown-item" href="/Menu b√°nh/html/sweetin.html">Sweetin - B√°nh H·ªôp Thi·∫øc Cao C·∫•p</a>
                                    <a class="dropdown-item" href="/Menu b√°nh/html/entrement.html">B√°nh Entreme</a>
                                    <a class="dropdown-item" href="/Menu b√°nh/html/mousse.html">B√°nh Mousse</a>
                                    <a class="dropdown-item" href="/Menu b√°nh/html/kembap.html">B√°nh Kem B·∫Øp</a>
                                    <a class="dropdown-item" href="/Menu b√°nh/html/flangato.html">B√°nh Flan Gato</a>

                                </div>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/4menu/BTap nh√≥m thi·∫øt k·∫ø web/btap/khachhang.html">Kh√°ch h√†ng th√¢n thi·∫øt</a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="/4menu/BTap nh√≥m thi·∫øt k·∫ø web/btap/giaohang.html">Giao h√†ng</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/4menu/BTap nh√≥m thi·∫øt k·∫ø web/btap/lienhe.html">Li√™n h·ªá</a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="/4menu/BTap nh√≥m thi·∫øt k·∫ø web/btap/cuahang.html">C·ª≠a h√†ng</a>
                            </li>
                            <li class="nav-item active">
                                <a class="nav-link" href="/Menu b√°nh/GioHang/GioHang.html">Gi·ªè H√†ng</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownTinTuc" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Tin t·ª©c
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdownTinTuc">
                                    <a class="dropdown-item" href="/Tintuc/Blog.html">Blog</a>
                                    <a class="dropdown-item" href="/Tintuc/Uudai.html">∆Øu ƒë√£i</a>
                                </div>
                            </li>
                            <li class="nav-item dropdown user-menu " id="user-guest-menu">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarUserMenuGuest" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-user"></i>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarUserMenuGuest">
                                    <a class="dropdown-item" href="/Home Page/src/login.html">ƒêƒÉng nh·∫≠p</a>
                                    <a class="dropdown-item" href="/Home Page/src/login.html">ƒêƒÉng k√Ω</a>
                                </div>
                            </li>
                            <li class="nav-item dropdown user-menu" id="user-member-menu" style="display: none;">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarUserMenuMember" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <strong id="welcome-message">Ch√†o, B·∫°n!</strong>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarUserMenuMember">
                                    <a class="dropdown-item" href="/Home Page/src/myprofile.html">T√†i kho·∫£n c·ªßa t√¥i</a>
                                    <a class="dropdown-item" href="javascript:logout()">ƒêƒÉng xu·∫•t</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <div class="container main-container">
            <div class="voucher-list-box" style="margin: 20px;">
                <h5>üéÅ C√°c m√£ gi·∫£m gi√° c√≥ s·∫µn (Nh·∫•p ƒë·ªÉ sao ch√©p):</h5>
                <p class="voucher-item">
                    <span class="badge voucher-code" data-code="FREESHIP">FREESHIP</span>
                    <span class="voucher-condition"> - Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn (cho ƒë∆°n t·ªëi thi·ªÉu 300.000 ƒë)</span>
                </p>
                <p class="voucher-item">
                    <span class="badge voucher-code" data-code="VOUCHER10K">VOUCHER10K</span>
                    <span class="voucher-condition"> - Gi·∫£m 10.000 ƒë (cho ƒë∆°n t·ªëi thi·ªÉu 200.000 ƒë)</span>
                </p>
                <p class="voucher-item">
                    <span class="badge voucher-code" data-code="VOUCHER50K">VOUCHER50K</span>
                    <span class="voucher-condition"> - Gi·∫£m 50.000 ƒë (cho ƒë∆°n t·ªëi thi·ªÉu 500.000 ƒë)</span>
                </p>
                <p class="voucher-item">
                    <span class="badge voucher-code" data-code="VOUCHER100K">VOUCHER100K</span>
                    <span class="voucher-condition"> - Gi·∫£m 100.000 ƒë (cho ƒë∆°n t·ªëi thi·ªÉu 800.000 ƒë)</span>
                </p>
                <p class="voucher-item">
                    <span class="badge voucher-code" data-code="VOUCHER500K">VOUCHER500K</span>
                    <span class="voucher-condition"> - Gi·∫£m 500.000 ƒë (cho ƒë∆°n t·ªëi thi·ªÉu 2.000.000 ƒë)</span>
                </p>
            </div>

            <div class="checkout-steps-wrapper">
                <ul class="checkout-steps">
                    <li id="step1-li" class="completed active"><span class="step-number" id="step1-num">1</span> Gi·ªè h√†ng</li>
                    <li id="step2-li"><span class="step-number" id="step2-num">2</span> Thanh to√°n</li>
                    <li id="step3-li"><span class="step-number" id="step3-num">3</span> ƒê∆°n h√†ng</li>
                </ul>
            </div>

            <div class="page-content-wrapper">

                <div id="cart-page" style="display: block;">
                    <div class="row">
                        <div class="col-md-7">
                            <table class="table product-details table-borderless align-middle">
                                <thead>
                                    <tr>
                                        <th style="width: 50%;">S·∫¢N PH·∫®M</th>
                                        <th style="width: 15%;">GI√Å</th>
                                        <th style="width: 20%;">S·ªê L∆Ø·ª¢NG</th>
                                        <th style="width: 10%;">T·∫†M T√çNH</th>
                                        <th style="width: 5%;"></th>
                                    </tr>
                                </thead>
                                <tbody id="cart-body">
                                </tbody>
                            </table>

                            <hr class="my-4">

                            <div class="row">
                                <div class="col-md-7">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="cart-promo-input" placeholder="M√£ ∆∞u ƒë√£i">
                                        <div class="input-group-append">
                                            <button class="btn btn-secondary-custom" type="button" id="cart-apply-promo">√Åp d·ª•ng</button>
                                        </div>
                                    </div>
                                    <small class="text-danger mt-1 d-block" id="cart-promo-error"></small>
                                    <small class="text-success mt-1 d-block" id="cart-promo-success"></small>
                                </div>

                            </div>
                        </div>

                        <div class="col-md-5">
                            <div class="cart-summary-box">
                                <h3>C·ªông gi·ªè h√†ng</h3>
                                <div class="summary-row">
                                    <span>T·∫°m t√≠nh</span>
                                    <span id="cart-temp-price-1">0 ƒë</span>
                                </div>
                                <div class="summary-row">
                                    <span>Gi·∫£m gi√°</span>
                                    <span id="cart-discount-display" class="voucher-applied">- 0 ƒë</span>
                                </div>
                                <div class="summary-row">
                                    <span>Giao h√†ng</span>
                                    <span id="cart-shipping-display">0 ƒë</span>
                                </div>
                                <div class="summary-row total-row">
                                    <span>T·ªïng</span>
                                    <span id="cart-total-price">0 ƒë</span>
                                </div>
                                <button id="goToCheckoutBtn" class="btn btn-primary-custom mt-3">Ti·∫øn h√†nh thanh to√°n</button>
                                <p class="text-center mt-3"><a href="../html/Menu.html">‚Üê Ti·∫øp t·ª•c xem s·∫£n ph·∫©m</a></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="checkout-page" style="display: none;">

                    <div class="checkout-promo-banner">
                        <span>N·∫øu b·∫°n c√≥ m√£ gi·∫£m gi√°, vui l√≤ng ƒëi·ªÅn v√†o ph√≠a b√™n d∆∞·ªõi.</span>
                        <input type="text" class="form-control form-control-sm" id="checkout-promo-input" placeholder="M√£ ∆∞u ƒë√£i">
                        <button class="btn btn-secondary-custom btn-sm" id="checkout-apply-promo">√Åp d·ª•ng</button>
                    </div>
                    <small class="text-danger d-block text-center mb-3" id="checkout-promo-error"></small>
                    <small class="text-success d-block text-center mb-3" id="checkout-promo-success"></small>

                    <div class="row mt-4">
                        <div class="col-md-7 payment-info">
                            <h3>Th√¥ng tin thanh to√°n</h3>
                            <form id="checkout-form">
                                <div class="form-group">
                                    <label for="hoTen">H·ªç v√† t√™n <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="hoTen" placeholder="Nh·∫≠p h·ªç v√† t√™n" required>
                                </div>
                                <div class="form-group">
                                    <label for="sdt">S·ªë ƒëi·ªán tho·∫°i <span class="text-danger">*</span></label>
                                    <input type="tel" class="form-control" id="sdt" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                                </div>

                                <div class="form-group">
                                    <label for="tinhThanh">T·ªânh/Th√†nh ph·ªë <span class="text-danger">*</span></label>
                                    <select class="form-control" id="tinhThanh" required>
                                        <option value="hcm" selected>Tp. H·ªì Ch√≠ Minh</option>
                                        <option value="binhduong">B√¨nh D∆∞∆°ng</option>
                                        <option value="dongnai">ƒê·ªìng Nai</option>
                                        <option value="other">T·ªânh/Th√†nh ph·ªë kh√°c</option>
                                    </select>
                                </div>

                                <div class="form-group" id="district-group">
                                    <label for="quanHuyen">Qu·∫≠n huy·ªán <span class="text-danger">*</span></label>
                                    <select class="form-control" id="quanHuyen" required></select>
                                </div>

                                <div class="form-group" id="ward-group">
                                    <label for="phuongXa">Ph∆∞·ªùng/X√£ <span class="text-danger">*</span></label>
                                    <select class="form-control" id="phuongXa" required></select>
                                </div>

                                <div class="form-group" id="address-detail-group">
                                    <label for="diaChi">ƒê·ªãa ch·ªâ (S·ªë nh√†, T√™n ƒë∆∞·ªùng) <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="diaChi" placeholder="To√† nh√†, s·ªë nh√†, t√™n ƒë∆∞·ªùng" required>
                                </div>

                                <div class="form-group" id="manual-address-group" style="display: none;">
                                    <label for="manualAddress">ƒê·ªãa ch·ªâ chi ti·∫øt <span class="text-danger">*</span></label>
                                    <textarea class="form-control" id="manualAddress" rows="3" placeholder="V√≠ d·ª•: C√† Mau, Huy·ªán C√°i N∆∞·ªõc, X√£ Ph√∫ H∆∞ng..." required></textarea>
                                </div>

                                <button type="button" class="btn btn-primary-custom my-3" id="validate-address-btn">GIAO H√ÄNG T·ªöI ƒê·ªäA CH·ªà N√ÄY</button>

                                <div class="form-group">
                                    <label for="ghiChu">Ghi ch√∫ ƒë∆°n h√†ng (t√πy ch·ªçn)</label>
                                    <textarea class="form-control" id="ghiChu" rows="4" placeholder="Ghi ch√∫ v·ªÅ ƒë∆°n h√†ng, v√≠ d·ª•: th·ªùi gian hay ch·ªâ d·∫´n ƒë·ªãa ƒëi·ªÉm giao h√†ng chi ti·∫øt h∆°n."></textarea>
                                </div>
                            </form>
                        </div>

                        <div class="col-md-5">
                            <div class="order-summary-box">
                                <h3>ƒê∆°n h√†ng c·ªßa b·∫°n</h3>
                                <table>
                                    <thead>
                                        <tr>
                                            <td>S·∫£n ph·∫©m</td>
                                            <td class="text-right">T·∫°m t√≠nh</td>
                                        </tr>
                                    </thead>
                                    <tbody id="checkout-body">
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td>T·∫°m t√≠nh</td>
                                            <td class="text-right" id="checkout-subtotal-display">0 ƒë</td>
                                        </tr>
                                        <tr>
                                            <td>Gi·∫£m gi√°</td>
                                            <td class="text-right voucher-applied" id="checkout-discount-display">- 0 ƒë</td>
                                        </tr>
                                        <tr>
                                            <td>Giao h√†ng</td>
                                            <td class="text-right" id="checkout-shipping-display">0 ƒë</td>
                                        </tr>
                                        <tr class="total-row">
                                            <td>T·ªïng</td>
                                            <td class="text-right" id="checkout-total-price">0 ƒë</td>
                                        </tr>
                                    </tfoot>
                                </table>

                                <div class="payment-methods mt-4">
                                    <div class="payment-method active border p-3 mb-2 rounded">
                                        <div class="custom-control custom-radio">
                                            <input type="radio" id="cod" name="paymentMethod" class="custom-control-input" checked>
                                            <label class="custom-control-label font-weight-bold" for="cod">Thanh to√°n ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</label>
                                        </div>
                                        <div class="payment-method-details">
                                            B·∫°n s·∫Ω thanh to√°n tr·ª±c ti·∫øp v·ªõi shipper.
                                        </div>
                                    </div>
                                    <div class="payment-method border p-3 rounded">
                                        <div class="custom-control custom-radio">
                                            <input type="radio" id="bankTransfer" name="paymentMethod" class="custom-control-input">
                                            <label class="custom-control-label font-weight-bold" for="bankTransfer">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</label>
                                        </div>
                                    </div>
                                </div>

                                <button type="button" class="btn btn-danger-custom mt-4" id="place-order-btn">ƒê·∫∂T H√ÄNG</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="order-confirmation-page" style="display: none;">
                    <div class="row justify-content-center">
                        <div class="col-lg-10 text-center">
                            <svg width="80" height="80" fill="#27ae60" class="bi bi-check-circle-fill mb-3" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                            </svg>
                            <h2 class="mb-3">C·∫£m ∆°n b·∫°n. ƒê∆°n h√†ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ti·∫øp nh·∫≠n.</h2>
                            <p class="text-muted">Ch√∫ng t√¥i s·∫Ω li√™n h·ªá v·ªõi b·∫°n qua s·ªë ƒëi·ªán tho·∫°i ƒë√£ cung c·∫•p ƒë·ªÉ x√°c nh·∫≠n tr∆∞·ªõc khi giao h√†ng.</p>
                            <hr class="my-4">

                            <div class="row text-left my-4">
                                <div class="col-md-3">
                                    <strong>M√É ƒê∆†N H√ÄNG:</strong>
                                    <p id="conf-order-id">#000000</p>
                                </div>
                                <div class="col-md-3">
                                    <strong>NG√ÄY ƒê·∫∂T:</strong>
                                    <p id="conf-order-date">--/--/----</p>
                                </div>
                                <div class="col-md-3">
                                    <strong>T·ªîNG C·ªòNG:</strong>
                                    <p id="conf-order-total" class="font-weight-bold">0 ƒë</p>
                                </div>
                                <div class="col-md-3">
                                    <strong>THANH TO√ÅN:</strong>
                                    <p id="conf-order-payment">...</p>
                                </div>
                            </div>

                            <div class="order-summary-box text-left">
                                <h3 class="mb-3">Chi ti·∫øt ƒë∆°n h√†ng</h3>
                                <table>
                                    <thead>
                                        <tr>
                                            <td>S·∫£n ph·∫©m</td>
                                            <td class="text-right">T·ªïng</td>
                                        </tr>
                                    </thead>
                                    <tbody id="conf-product-list">
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td>T·∫°m t√≠nh</td>
                                            <td class="text-right" id="conf-subtotal">0 ƒë</td>
                                        </tr>
                                        <tr>
                                            <td>Gi·∫£m gi√°</td>
                                            <td class="text-right" id="conf-discount">- 0 ƒë</td>
                                        </tr>
                                        <tr>
                                            <td>Giao h√†ng</td>
                                            <td class="text-right" id="conf-shipping">0 ƒë</td>
                                        </tr>
                                        <tr class="total-row">
                                            <td>T·ªïng</td>
                                            <td class="text-right" id="conf-grand-total">0 ƒë</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <div class="order-summary-box text-left mt-4">
                                <h3 class="mb-3">Th√¥ng tin kh√°ch h√†ng</h3>
                                <p class="mb-1"><strong>H·ªç v√† t√™n:</strong> <span id="conf-customer-name"></span></p>
                                <p class="mb-1"><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span id="conf-customer-phone"></span></p>
                                <p class="mb-1"><strong>ƒê·ªãa ch·ªâ:</strong> <span id="conf-customer-address"></span></p>
                                <p class="mb-1"><strong>Ghi ch√∫:</strong> <span id="conf-customer-notes"></span></p>
                            </div>

                            <a href="../html/Menu.html" class="btn btn-primary-custom mt-4" style="width: auto; padding: 12px 30px;">
                                ‚Üê Quay l·∫°i mua h√†ng
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <script>
            // =======================================================
            // 1. D·ªÆ LI·ªÜU C·ªê ƒê·ªäNH & BI·∫æN TO√ÄN C·ª§C
            // =======================================================
            const SHIPPING_FEE = 40000;

            // --- THAY ƒê·ªîI BI·∫æN TO√ÄN C·ª§C ---
            // Ch√∫ng ta c·∫ßn 2 bi·∫øn ri√™ng bi·ªát ƒë·ªÉ l∆∞u 2 lo·∫°i voucher
            let currentDiscountVoucherCode = '';
            let currentShippingVoucherCode = '';

            // --- C·∫¨P NH·∫¨T C·∫§U TR√öC VOUCHER ---
            // Th√™m 'type' ƒë·ªÉ ph√¢n bi·ªát voucher 'discount' (gi·∫£m ti·ªÅn) v√† 'shipping' (giao h√†ng)
            const VOUCHERS = {
                'FREESHIP': { type: 'shipping', discount: 'free', min_order: 300000 },
                'VOUCHER10K': { type: 'discount', discount: 10000, min_order: 200000 },
                'VOUCHER50K': { type: 'discount', discount: 50000, min_order: 500000 },
                'VOUCHER100K': { type: 'discount', discount: 100000, min_order: 800000 },
                'VOUCHER500K': { type: 'discount', discount: 500000, min_order: 2000000 }
            };

            // !================================================!
            // ! === KH·ªêI cityData ƒê√É ƒê∆Ø·ª¢C C·∫¨P NH·∫¨T ƒê·∫¶Y ƒê·ª¶ === !
            // !================================================!
            const cityData = {
                'hcm': {
                    'Qu·∫≠n 1': ['Ph∆∞·ªùng B·∫øn Ngh√©', 'Ph∆∞·ªùng B·∫øn Th√†nh', 'Ph∆∞·ªùng C·∫ßu Kho', 'Ph∆∞·ªùng C·∫ßu √îng L√£nh', 'Ph∆∞·ªùng C√¥ Giang', 'Ph∆∞·ªùng ƒêa Kao', 'Ph∆∞·ªùng Nguy·ªÖn C∆∞ Trinh', 'Ph∆∞·ªùng Nguy·ªÖn Th√°i B√¨nh', 'Ph∆∞·ªùng Ph·∫°m Ng≈© L√£o', 'Ph∆∞·ªùng T√¢n ƒê·ªãnh'],
                    'Qu·∫≠n 3': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14'],
                    'Qu·∫≠n 5': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14'],
                    'Qu·∫≠n 7': ['Ph∆∞·ªùng B√¨nh Thu·∫≠n', 'Ph∆∞·ªùng Ph√∫ M·ªπ', 'Ph∆∞·ªùng Ph√∫ Thu·∫≠n', 'Ph∆∞·ªùng T√¢n H∆∞ng', 'Ph∆∞·ªùng T√¢n Ki·ªÉng', 'Ph∆∞·ªùng T√¢n Phong', 'Ph∆∞·ªùng T√¢n Ph√∫', 'Ph∆∞·ªùng T√¢n Quy', 'Ph∆∞·ªùng T√¢n Thu·∫≠n ƒê√¥ng', 'Ph∆∞·ªùng T√¢n Thu·∫≠n T√¢y'],
                    'Qu·∫≠n B√¨nh Th·∫°nh': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15', 'Ph∆∞·ªùng 17', 'Ph∆∞·ªùng 19', 'Ph∆∞·ªùng 21', 'Ph∆∞·ªùng 22', 'Ph∆∞·ªùng 24', 'Ph∆∞·ªùng 25', 'Ph∆∞·ªùng 26', 'Ph∆∞·ªùng 27', 'Ph∆∞·ªùng 28'],
                    'Th√†nh ph·ªë Th·ªß ƒê·ª©c': ['Ph∆∞·ªùng An Kh√°nh', 'Ph∆∞·ªùng An L·ª£i ƒê√¥ng', 'Ph∆∞·ªùng An Ph√∫', 'Ph∆∞·ªùng B√¨nh Chi·ªÉu', 'Ph∆∞·ªùng B√¨nh Th·ªç', 'Ph∆∞·ªùng Linh Chi·ªÉu', 'Ph∆∞·ªùng Linh ƒê√¥ng', 'Ph∆∞·ªùng Linh Trung', 'Ph∆∞·ªùng Th·∫£o ƒêi·ªÅn', 'Ph∆∞·ªùng Tr∆∞·ªùng Th·ªç'],
                    'Huy·ªán B√¨nh Ch√°nh': ['Th·ªã tr·∫•n T√¢n T√∫c', 'X√£ An Ph√∫ T√¢y', 'X√£ B√¨nh Ch√°nh', 'X√£ B√¨nh H∆∞ng', 'X√£ B√¨nh L·ª£i', 'X√£ ƒêa Ph∆∞·ªõc', 'X√£ H∆∞ng Long', 'X√£ L√™ Minh Xu√¢n', 'X√£ Ph·∫°m VƒÉn Hai', 'X√£ Phong Ph√∫', 'X√£ Qui ƒê·ª©c', 'X√£ T√¢n Ki√™n', 'X√£ T√¢n Nh·ª±t', 'X√£ Vƒ©nh L·ªôc A', 'X√£ Vƒ©nh L·ªôc B'],
                    'Qu·∫≠n T√¢n B√¨nh': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15'],
                    'Qu·∫≠n G√≤ V·∫•p': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15', 'Ph∆∞·ªùng 16', 'Ph∆∞·ªùng 17'],
                    'Qu·∫≠n 4': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15', 'Ph∆∞·ªùng 16', 'Ph∆∞·ªùng 18'],
                    'Qu·∫≠n 6': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14'],
                    'Qu·∫≠n 8': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15', 'Ph∆∞·ªùng 16'],
                    'Qu·∫≠n 10': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15'],
                    'Qu·∫≠n 11': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 6', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15', 'Ph∆∞·ªùng 16'],
                    'Qu·∫≠n 12': ['Ph∆∞·ªùng An Ph√∫ ƒê√¥ng', 'Ph∆∞·ªùng ƒê√¥ng H∆∞ng Thu·∫≠n', 'Ph∆∞·ªùng Hi·ªáp Th√†nh', 'Ph∆∞·ªùng T√¢n Ch√°nh Hi·ªáp', 'Ph∆∞·ªùng T√¢n H∆∞ng Thu·∫≠n', 'Ph∆∞·ªùng T√¢n Th·ªõi Hi·ªáp', 'Ph∆∞·ªùng Th·∫°nh L·ªôc', 'Ph∆∞·ªùng Th·∫°nh Xu√¢n', 'Ph∆∞·ªùng Trung M·ªπ T√¢y', 'Ph∆∞·ªùng Hi·ªáp Th√†nh'],
                    'Qu·∫≠n Ph√∫ Nhu·∫≠n': ['Ph∆∞·ªùng 1', 'Ph∆∞·ªùng 2', 'Ph∆∞·ªùng 3', 'Ph∆∞·ªùng 4', 'Ph∆∞·ªùng 5', 'Ph∆∞·ªùng 7', 'Ph∆∞·ªùng 8', 'Ph∆∞·ªùng 9', 'Ph∆∞·ªùng 10', 'Ph∆∞·ªùng 11', 'Ph∆∞·ªùng 12', 'Ph∆∞·ªùng 13', 'Ph∆∞·ªùng 14', 'Ph∆∞·ªùng 15', 'Ph∆∞·ªùng 17'],
                    'Qu·∫≠n T√¢n Ph√∫': ['Ph∆∞·ªùng Hi·ªáp T√¢n', 'Ph∆∞·ªùng Ho√† Th·∫°nh', 'Ph∆∞·ªùng Ph√∫ Th·∫°nh', 'Ph∆∞·ªùng Ph√∫ Trung', 'Ph∆∞·ªùng S∆°n K·ª≥', 'Ph∆∞·ªùng T√¢n Qu√Ω', 'Ph∆∞·ªùng T√¢n S∆°n Nh√¨', 'Ph∆∞·ªùng T√¢n Th√†nh', 'Ph∆∞·ªùng T√¢n Th·ªõi Ho√†', 'Ph∆∞·ªùng T√¢y Th·∫°nh', 'Ph∆∞·ªùng Hi·ªáp T√¢n'],
                    'Qu·∫≠n B√¨nh T√¢n': ['Ph∆∞·ªùng An L·∫°c', 'Ph∆∞·ªùng An L·∫°c A', 'Ph∆∞·ªùng B√¨nh H∆∞ng Ho√†', 'Ph∆∞·ªùng B√¨nh H∆∞ng Ho√† A', 'Ph∆∞·ªùng B√¨nh H∆∞ng Ho√† B', 'Ph∆∞·ªùng B√¨nh Tr·ªã ƒê√¥ng', 'Ph∆∞·ªùng B√¨nh Tr·ªã ƒê√¥ng A', 'Ph∆∞·ªùng B√¨nh Tr·ªã ƒê√¥ng B', 'Ph∆∞·ªùng T√¢n T·∫°o', 'Ph∆∞·ªùng T√¢n T·∫°o A'],
                    'Huy·ªán C·ªß Chi': ['Th·ªã tr·∫•n C·ªß Chi', 'X√£ An Nh∆°n T√¢y', 'X√£ An Ph√∫', 'X√£ B√¨nh M·ªπ', 'X√£ Ho√† Ph√∫', 'X√£ Nhu·∫≠n ƒê·ª©c', 'X√£ Ph·∫°m VƒÉn C·ªôi', 'X√£ Ph√∫ Ho√† ƒê√¥ng', 'X√£ T√¢n An H·ªôi', 'X√£ T√¢n Ph√∫ Trung', 'X√£ T√¢n Th·∫°nh ƒê√¥ng', 'X√£ Th√°i M·ªπ', 'X√£ Trung L·∫≠p Th∆∞·ª£ng', 'X√£ Ph∆∞·ªõc Vƒ©nh An', 'X√£ T√¢n Th√¥ng H·ªôi', 'X√£ Trung L·∫≠p H·∫°'],
                    'Huy·ªán H√≥c M√¥n': ['Th·ªã tr·∫•n H√≥c M√¥n', 'X√£ B√† ƒêi·ªÉm', 'X√£ ƒê√¥ng Th·∫°nh', 'X√£ Nh·ªã B√¨nh', 'X√£ T√¢n Hi·ªáp', 'X√£ T√¢n Th·ªõi Nh√¨', 'X√£ T√¢n Xu√¢n', 'X√£ Th·ªõi Tam Th√¥n', 'X√£ Trung Ch√°nh', 'X√£ Xu√¢n Th·ªõi ƒê√¥ng', 'X√£ Xu√¢n Th·ªõi S∆°n', 'X√£ Xu√¢n Th·ªõi Th∆∞·ª£ng'],
                    'Huy·ªán Nh√† B√®': ['Th·ªã tr·∫•n Nh√† B√®', 'X√£ Hi·ªáp Ph∆∞·ªõc', 'X√£ Long Th·ªõi', 'X√£ Nh∆°n ƒê·ª©c', 'X√£ Ph√∫ Xu√¢n', 'X√£ Ph∆∞·ªõc Ki·ªÉn', 'X√£ Ph∆∞·ªõc L·ªôc'],
                    'Huy·ªán C·∫ßn Gi·ªù': ['Th·ªã tr·∫•n C·∫ßn Th·∫°nh', 'X√£ An Th·ªõi ƒê√¥ng', 'X√£ B√¨nh Kh√°nh', 'X√£ Long H√≤a', 'X√£ L√Ω Nh∆°n', 'X√£ Tam Th√¥n Hi·ªáp', 'X√£ Th·∫°nh An'],
                },
                'binhduong': {
                    'Th·ªß D·∫ßu M·ªôt': ['Ph∆∞·ªùng Hi·ªáp Th√†nh', 'Ph∆∞·ªùng Ph√∫ L·ª£i', 'Ph∆∞·ªùng Ph√∫ H√≤a', 'Ph∆∞·ªùng Ph√∫ Th·ªç', 'Ph∆∞·ªùng Ch√°nh Nghƒ©a'],
                    'Thu·∫≠n An': ['Ph∆∞·ªùng An Ph√∫', 'Ph∆∞·ªùng B√¨nh Chu·∫©n', 'Ph∆∞·ªùng B√¨nh H√≤a', 'Ph∆∞·ªùng L√°i Thi√™u', 'Ph∆∞·ªùng Thu·∫≠n Giao']
                },
                'dongnai': {
                    'Bi√™n H√≤a': ['Ph∆∞·ªùng An B√¨nh', 'Ph∆∞·ªùng B·ª≠u H√≤a', 'Ph∆∞·ªùng H√≤a B√¨nh', 'Ph∆∞·ªùng T√¢n Bi√™n', 'Ph∆∞·ªùng Long B√¨nh T√¢n'],
                    'Long Kh√°nh': ['Ph∆∞·ªùng Xu√¢n An', 'Ph∆∞·ªùng Xu√¢n B√¨nh', 'Ph∆∞·ªùng Xu√¢n Ho√†', 'Ph∆∞·ªùng Ph√∫ B√¨nh', 'Ph∆∞·ªùng B·∫£o Vinh']
                }
            };

            // =======================================================
            // 2. KHAI B√ÅO BI·∫æN DOM
            // =======================================================
            const cartPage = document.getElementById('cart-page');
            const checkoutPage = document.getElementById('checkout-page');
            const orderConfirmationPage = document.getElementById('order-confirmation-page');
            const goToCheckoutBtn = document.getElementById('goToCheckoutBtn');
            const placeOrderBtn = document.getElementById('place-order-btn');
            const validateAddressBtn = document.getElementById('validate-address-btn');
            const step1Li = document.getElementById('step1-li');
            const step2Li = document.getElementById('step2-li');
            const step3Li = document.querySelector('.checkout-steps li:last-child');
            const step1Num = document.getElementById('step1-num');
            const step2Num = document.getElementById('step2-num');
            const step3Num = step3Li.querySelector('.step-number');
            const cartBody = document.getElementById('cart-body');
            const checkoutBody = document.getElementById('checkout-body');
            const confProductList = document.getElementById('conf-product-list');
            const tinhThanhSelect = document.getElementById('tinhThanh');
            const quanHuyenSelect = document.getElementById('quanHuyen');
            const phuongXaSelect = document.getElementById('phuongXa');
            const districtGroup = document.getElementById('district-group');
            const wardGroup = document.getElementById('ward-group');
            const addressDetailGroup = document.getElementById('address-detail-group');
            const manualAddressGroup = document.getElementById('manual-address-group');
            const checkoutForm = document.getElementById('checkout-form');
            const cartPromoInput = document.getElementById('cart-promo-input');
            const cartApplyPromoBtn = document.getElementById('cart-apply-promo');
            const cartPromoError = document.getElementById('cart-promo-error');
            const cartPromoSuccess = document.getElementById('cart-promo-success');
            const checkoutPromoInput = document.getElementById('checkout-promo-input');
            const checkoutApplyPromoBtn = document.getElementById('checkout-apply-promo');
            const checkoutPromoError = document.getElementById('checkout-promo-error');
            const checkoutPromoSuccess = document.getElementById('checkout-promo-success');
            const cartTempPrice1 = document.getElementById('cart-temp-price-1');
            const cartDiscountDisplay = document.getElementById('cart-discount-display');
            const cartShippingDisplay = document.getElementById('cart-shipping-display');
            const cartTotalDisplay = document.getElementById('cart-total-price');
            const checkoutSubtotalDisplay = document.getElementById('checkout-subtotal-display');
            const checkoutDiscountDisplay = document.getElementById('checkout-discount-display');
            const checkoutShippingDisplay = document.getElementById('checkout-shipping-display');
            const checkoutTotalDisplay = document.getElementById('checkout-total-price');
            const confSubtotal = document.getElementById('conf-subtotal');
            const confDiscount = document.getElementById('conf-discount');
            const confShipping = document.getElementById('conf-shipping');
            const confGrandTotal = document.getElementById('conf-grand-total');

            // =======================================================
            // 3. H√ÄM TI·ªÜN √çCH (Gi·ªè h√†ng & ƒê·ªãnh d·∫°ng)
            // =======================================================
            function formatVND(amount) {
                if (typeof amount !== 'number') amount = 0;
                return amount.toLocaleString('vi-VN') + ' ƒë';
            }
            function getCart() { return JSON.parse(localStorage.getItem('cart')) || []; }
            function saveCart(cart) { localStorage.setItem('cart', JSON.stringify(cart)); }
            function calculateSubtotal() {
                return getCart().reduce((total, item) => total + (item.price * item.quantity), 0);
            }

            // =======================================================
            // 4. H√ÄM RENDER & T√çNH TO√ÅN CH√çNH (ƒê√É C·∫¨P NH·∫¨T)
            // =======================================================
            function renderCart() {
                const cart = getCart();
                cartBody.innerHTML = '';
                checkoutBody.innerHTML = '';

                if (cart.length === 0) {
                    const emptyMsg = '<tr><td colspan="5" class="text-center p-4">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</td></tr>';
                    cartBody.innerHTML = emptyMsg;
                    checkoutBody.innerHTML = '<tr><td colspan="2" class="text-center p-3">Kh√¥ng c√≥ s·∫£n ph·∫©m.</td></tr>';
                } else {
                    cart.forEach(item => {
                        const itemSubtotal = item.price * item.quantity;
                        const cartRow = document.createElement('tr');
                        cartRow.innerHTML = `
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="${item.image}" class="product-image" alt="${item.name}">
                                    <span class="product-name">${item.name}</span>
                                </div>
                            </td>
                            <td>${formatVND(item.price)}</td>
                            <td>
                                <div class="quantity-control-v2">
                                    <button class="btn btn-outline-secondary qty-minus" type="button" data-id="${item.id}">-</button>
                                    <input type="text" class="form-control quantity-input" value="${item.quantity}" readonly>
                                    <button class="btn btn-outline-secondary qty-plus" type="button" data-id="${item.id}">+</button>
                                </div>
                            </td>
                            <td><strong>${formatVND(itemSubtotal)}</strong></td>
                            <td><span class="remove-btn" data-id="${item.id}" title="X√≥a s·∫£n ph·∫©m">&times;</span></td>
                        `;
                        cartBody.appendChild(cartRow);

                        const checkoutRow = document.createElement('tr');
                        checkoutRow.innerHTML = `
                            <td class="product-name">${item.name} <span class="text-muted">&times; ${item.quantity}</span></td>
                            <td class="price text-right">${formatVND(itemSubtotal)}</td>
                        `;
                        checkoutBody.appendChild(checkoutRow);
                    });
                }
                calculateAndDisplayTotals();
                addCartEventListeners();
            }

            /**
             * H√ÄM QUAN TR·ªåNG NH·∫§T: ƒê√É VI·∫æT L·∫†I HO√ÄN TO√ÄN
             * T√≠nh to√°n t·ªïng ti·ªÅn d·ª±a tr√™n 2 m√£ voucher (gi·∫£m gi√° v√† freeship)
             */
            function calculateAndDisplayTotals() {
                const subtotal = calculateSubtotal();
                let currentShipping = (subtotal > 0) ? SHIPPING_FEE : 0;
                let finalDiscount = 0;
                let discountVoucherValid = false;
                let shippingVoucherValid = false;

                // X√≥a th√¥ng b√°o c≈©
                cartPromoError.textContent = '';
                cartPromoSuccess.textContent = '';
                checkoutPromoError.textContent = '';
                checkoutPromoSuccess.textContent = '';

                // 1. Ki·ªÉm tra voucher GI·∫¢M GI√Å
                if (currentDiscountVoucherCode) {
                    const voucher = VOUCHERS[currentDiscountVoucherCode];
                    if (voucher && subtotal >= voucher.min_order) {
                        finalDiscount = voucher.discount;
                        discountVoucherValid = true;
                    } else {
                        // M√£ kh√¥ng c√≤n h·ª£p l·ªá (do t·ªïng ti·ªÅn thay ƒë·ªïi), x√≥a m√£
                        currentDiscountVoucherCode = '';
                        cartPromoError.textContent = 'M√£ gi·∫£m gi√° kh√¥ng c√≤n h·ª£p l·ªá v·ªõi t·ªïng ti·ªÅn m·ªõi. ';
                    }
                }

                // 2. Ki·ªÉm tra voucher GIAO H√ÄNG
                if (currentShippingVoucherCode) {
                    const voucher = VOUCHERS[currentShippingVoucherCode];
                    if (voucher && subtotal >= voucher.min_order) {
                        currentShipping = 0; // Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn
                        shippingVoucherValid = true;
                    } else {
                        // M√£ kh√¥ng c√≤n h·ª£p l·ªá, x√≥a m√£
                        currentShippingVoucherCode = '';
                        cartPromoError.textContent += 'M√£ freeship kh√¥ng c√≤n h·ª£p l·ªá v·ªõi t·ªïng ti·ªÅn m·ªõi.';
                    }
                }

                // ƒê·ªìng b·ªô l·ªói (n·∫øu c√≥)
                checkoutPromoError.textContent = cartPromoError.textContent;

                // 3. Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng (n·∫øu c√≥)
                let successMsg = '';
                if (discountVoucherValid) {
                    successMsg += `ƒê√£ √°p d·ª•ng ${currentDiscountVoucherCode} (-${formatVND(finalDiscount)}). `;
                }
                if (shippingVoucherValid) {
                    successMsg += `ƒê√£ √°p d·ª•ng FREESHIP.`;
                }
                cartPromoSuccess.textContent = successMsg;
                checkoutPromoSuccess.textContent = successMsg;


                // 4. T√≠nh to√°n v√† hi·ªÉn th·ªã t·ªïng cu·ªëi c√πng
                const grandTotal = subtotal - finalDiscount + currentShipping;
                const subtotalVND = formatVND(subtotal);
                const finalDiscountVND = formatVND(finalDiscount);
                const grandTotalVND = formatVND(grandTotal);
                const currentShippingVND = formatVND(currentShipping);

                cartTempPrice1.textContent = subtotalVND;
                cartDiscountDisplay.textContent = `- ${finalDiscountVND}`;
                cartShippingDisplay.textContent = currentShippingVND;
                cartTotalDisplay.textContent = grandTotalVND;

                checkoutSubtotalDisplay.textContent = subtotalVND;
                checkoutDiscountDisplay.textContent = `- ${finalDiscountVND}`;
                checkoutShippingDisplay.textContent = currentShippingVND;
                checkoutTotalDisplay.textContent = grandTotalVND;
            }

            // =======================================================
            // 5. H√ÄM S·ª∞ KI·ªÜN (Click N√∫t) (ƒê√É C·∫¨P NH·∫¨T)
            // =======================================================
            function addCartEventListeners() {
                document.querySelectorAll('.qty-plus').forEach(button => {
                    button.onclick = (e) => updateItemQuantity(e.currentTarget.getAttribute('data-id'), 1);
                });
                document.querySelectorAll('.qty-minus').forEach(button => {
                    button.onclick = (e) => updateItemQuantity(e.currentTarget.getAttribute('data-id'), -1);
                });
                document.querySelectorAll('.remove-btn').forEach(button => {
                    button.onclick = (e) => removeItemFromCart(e.currentTarget.getAttribute('data-id'));
                });
                // G·∫Øn s·ª± ki·ªán click-to-copy cho voucher
                document.querySelectorAll('.voucher-code').forEach(badge => {
                    badge.addEventListener('click', () => {
                        const code = badge.getAttribute('data-code');
                        cartPromoInput.value = code;
                        checkoutPromoInput.value = code;

                        // T·ª± ƒë·ªông √°p d·ª•ng khi nh·∫•n
                        if (cartPage.style.display === 'block') {
                            applyPromoCode(cartPromoInput, cartPromoError, cartPromoSuccess);
                        } else {
                            applyPromoCode(checkoutPromoInput, checkoutPromoError, checkoutPromoSuccess);
                        }
                    });
                });
            }

            function updateItemQuantity(id, change) {
                let cart = getCart();
                const itemIndex = cart.findIndex(item => item.id === id);
                if (itemIndex > -1) {
                    cart[itemIndex].quantity += change;
                    if (cart[itemIndex].quantity <= 0) {
                        cart[itemIndex].quantity = 1;
                    }
                    saveCart(cart);
                    renderCart(); // renderCart s·∫Ω t·ª± ƒë·ªông g·ªçi calculateAndDisplayTotals()
                }
            }

            function removeItemFromCart(id) {
                let cart = getCart();
                cart = cart.filter(item => item.id !== id);
                saveCart(cart);
                renderCart(); // renderCart s·∫Ω t·ª± ƒë·ªông g·ªçi calculateAndDisplayTotals()
            }

            /**
             * H√ÄM √ÅP D·ª§NG M√É: ƒê√É VI·∫æT L·∫†I HO√ÄN TO√ÄN
             * Ph√¢n lo·∫°i m√£ v√† l∆∞u v√†o bi·∫øn state t∆∞∆°ng ·ª©ng
             */
            function applyPromoCode(inputElement, errorElement, successElement) {
                const promoCode = inputElement.value.toUpperCase().trim();
                const subtotal = calculateSubtotal();

                // X√≥a th√¥ng b√°o l·ªói/th√†nh c√¥ng c≈©
                errorElement.textContent = '';
                successElement.textContent = '';
                checkoutPromoError.textContent = ''; // X√≥a c·∫£ 2 b√™n
                checkoutPromoSuccess.textContent = '';
                cartPromoError.textContent = '';
                cartPromoSuccess.textContent = '';

                // ƒê·ªìng b·ªô h√≥a 2 √¥ input
                cartPromoInput.value = promoCode;
                checkoutPromoInput.value = promoCode;

                // N·∫øu nh·∫≠p chu·ªói r·ªóng, coi nh∆∞ mu·ªën x√≥a t·∫•t c·∫£ voucher
                if (promoCode === '') {
                    currentDiscountVoucherCode = '';
                    currentShippingVoucherCode = '';
                    calculateAndDisplayTotals();
                    return;
                }

                const voucher = VOUCHERS[promoCode];

                if (!voucher) {
                    errorElement.textContent = 'M√£ gi·∫£m gi√° kh√¥ng h·ª£p l·ªá.';
                } else if (subtotal < voucher.min_order) {
                    errorElement.textContent = `M√£ n√†y ch·ªâ √°p d·ª•ng cho ƒë∆°n h√†ng t·ª´ ${formatVND(voucher.min_order)}.`;
                } else {
                    // M√£ h·ª£p l·ªá, ki·ªÉm tra lo·∫°i voucher
                    if (voucher.type === 'shipping') {
                        currentShippingVoucherCode = promoCode;
                        successElement.textContent = '√Åp d·ª•ng Freeship th√†nh c√¥ng!';
                    }
                    else if (voucher.type === 'discount') {
                        currentDiscountVoucherCode = promoCode;
                        successElement.textContent = `Gi·∫£m ${formatVND(voucher.discount)} th√†nh c√¥ng!`;
                    }
                }

                // ƒê·ªìng b·ªô th√¥ng b√°o cho c·∫£ 2 trang
                if (inputElement === cartPromoInput) {
                    checkoutPromoError.textContent = errorElement.textContent;
                    checkoutPromoSuccess.textContent = successElement.textContent;
                } else {
                    cartPromoError.textContent = errorElement.textContent;
                    cartPromoSuccess.textContent = successElement.textContent;
                }

                // Quan tr·ªçng: T√≠nh to√°n l·∫°i t·ªïng ti·ªÅn sau khi √°p d·ª•ng
                calculateAndDisplayTotals();
            }

            // =======================================================
            // 6. LOGIC ƒê·ªäA CH·ªà (Gi·ªØ nguy√™n, kh√¥ng thay ƒë·ªïi)
            // =======================================================
            function updateDistrictOptions() {
                const selectedCityKey = tinhThanhSelect.value;
                quanHuyenSelect.innerHTML = '';
                phuongXaSelect.innerHTML = '';

                if (selectedCityKey === 'other') {
                    districtGroup.style.display = 'none';
                    wardGroup.style.display = 'none';
                    addressDetailGroup.style.display = 'none';
                    manualAddressGroup.style.display = 'block';
                    document.getElementById('manualAddress').required = true;
                    document.getElementById('quanHuyen').required = false;
                    document.getElementById('phuongXa').required = false;
                    document.getElementById('diaChi').required = false;
                } else {
                    districtGroup.style.display = 'block';
                    wardGroup.style.display = 'block';
                    addressDetailGroup.style.display = 'block';
                    manualAddressGroup.style.display = 'none';
                    document.getElementById('manualAddress').required = false;
                    document.getElementById('quanHuyen').required = true;
                    document.getElementById('phuongXa').required = true;
                    document.getElementById('diaChi').required = true;

                    const districtsInCity = cityData[selectedCityKey];
                    let defaultOption = document.createElement('option');
                    defaultOption.value = "";
                    defaultOption.textContent = "Ch·ªçn qu·∫≠n/huy·ªán";
                    quanHuyenSelect.appendChild(defaultOption);

                    if (districtsInCity) {
                        const sortedDistricts = Object.keys(districtsInCity).sort();
                        sortedDistricts.forEach(districtName => {
                            let option = document.createElement('option');
                            option.value = districtName;
                            option.textContent = districtName;
                            quanHuyenSelect.appendChild(option);
                        });
                    }
                    updateWardOptions();
                }
            }

            function updateWardOptions() {
                const selectedCityKey = tinhThanhSelect.value;
                const selectedDistrict = quanHuyenSelect.value;
                phuongXaSelect.innerHTML = '';

                let defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Ch·ªçn ph∆∞·ªùng/x√£";
                phuongXaSelect.appendChild(defaultOption);

                if (selectedCityKey && selectedDistrict && cityData[selectedCityKey] && cityData[selectedCityKey][selectedDistrict]) {
                    const wardsInDistrict = cityData[selectedCityKey][selectedDistrict];
                    if (wardsInDistrict) {
                        wardsInDistrict.sort().forEach(wardName => {
                            let option = document.createElement('option');
                            option.value = wardName;
                            option.textContent = wardName;
                            phuongXaSelect.appendChild(option);
                        });
                    }
                }
            }

            // =======================================================
            // 7. LOGIC CHUY·ªÇN TRANG & ƒê·∫∂T H√ÄNG (ƒê√É C·∫¨P NH·∫¨T)
            // =======================================================

            goToCheckoutBtn.addEventListener('click', () => {

                // Ki·ªÉm tra 1: Gi·ªè h√†ng c√≥ tr·ªëng kh√¥ng?
                if (getCart().length === 0) {
                    alert('Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng!');
                    return;
                }

                // === (TH√äM M·ªöI) KI·ªÇM TRA ƒêƒÇNG NH·∫¨P ===
                const currentUserJSON = localStorage.getItem('currentUser');

                if (!currentUserJSON) {
                    // N·∫øu CH∆ØA ƒëƒÉng nh·∫≠p:
                    alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c thanh to√°n.');

                    // L·∫•y ƒë∆∞·ªùng d·∫´n trang gi·ªè h√†ng hi·ªán t·∫°i (v√≠ d·ª•: "/Menu b√°nh/GioHang/GioHang.html")
                    const cartPageUrl = window.location.pathname;

                    // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang login, ƒë√≠nh k√®m link quay l·∫°i
                    // S·ª≠a "/login.html" n·∫øu file ƒëƒÉng nh·∫≠p c·ªßa b·∫°n c√≥ t√™n/ƒë∆∞·ªùng d·∫´n kh√°c
                    window.location.href = `/Home Page/src/login.html?redirect=${encodeURIComponent(cartPageUrl)}`;

                    return; // D·ª´ng h√†m, kh√¥ng cho xem trang checkout
                }
                // === K·∫æT TH√öC PH·∫¶N KI·ªÇM TRA ===

                // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p (v√† gi·ªè h√†ng c√≥ ƒë·ªì), ti·∫øp t·ª•c nh∆∞ c≈©:
                cartPage.style.display = 'none';
                checkoutPage.style.display = 'block';
                orderConfirmationPage.style.display = 'none';
                step1Li.classList.remove('active');
                step1Num.classList.remove('active');
                step2Li.classList.add('completed', 'active');
                step2Num.classList.add('active');
                step3Li.classList.remove('completed', 'active');
                step3Num.classList.remove('active');
                renderCart();
            });

            validateAddressBtn.addEventListener('click', () => {
                checkoutForm.reportValidity();
            });

            placeOrderBtn.addEventListener('click', (event) => {
                event.preventDefault();
                if (!checkoutForm.checkValidity()) {
                    checkoutForm.reportValidity();
                    return;
                }

                checkoutPage.style.display = 'none';
                orderConfirmationPage.style.display = 'block';

                step2Li.classList.remove('active');
                step2Num.classList.remove('active');
                step3Li.classList.add('completed', 'active');
                step3Num.classList.add('active');

                // L·∫•y d·ªØ li·ªáu (ƒê√É C·∫¨P NH·∫¨T LOGIC T√çNH TO√ÅN)
                const cart = getCart();
                const subtotal = calculateSubtotal();
                let finalDiscount = 0;
                let finalShipping = (subtotal > 0) ? SHIPPING_FEE : 0;

                // T√≠nh to√°n l·∫°i l·∫ßn cu·ªëi
                const discountVoucher = VOUCHERS[currentDiscountVoucherCode];
                if (discountVoucher && subtotal >= discountVoucher.min_order) {
                    finalDiscount = discountVoucher.discount;
                }

                const shippingVoucher = VOUCHERS[currentShippingVoucherCode];
                if (shippingVoucher && subtotal >= shippingVoucher.min_order) {
                    finalShipping = 0;
                }

                const grandTotal = subtotal - finalDiscount + finalShipping;
                // ... (code l·∫•y th√¥ng tin kh√°ch h√†ng, t√≠nh grandTotal) ...
                const currentCart = getCart(); // L·∫•y gi·ªè h√†ng TR∆Ø·ªöC KHI X√ìA
                const orderId = '#' + Math.floor(100000 + Math.random() * 900000); // T·∫°o M√£ ƒêH
                const orderDate = new Date().toLocaleDateString('vi-VN'); // L·∫•y ng√†y

                // ===============================================================
                // === B·∫ÆT ƒê·∫¶U KH·ªêI CODE M·ªöI: L∆ØU L·ªäCH S·ª¨ ƒê∆†N H√ÄNG ===
                // ===============================================================
                const currentUserJSON = localStorage.getItem('currentUser');
                if (currentUserJSON) {
                    let currentUser = JSON.parse(currentUserJSON);

                    // 1. C·∫≠p nh·∫≠t t·ªïng chi ti√™u (b·∫°n ƒë√£ c√≥ code n√†y)
                    if (typeof currentUser.totalSpent !== 'number' || isNaN(currentUser.totalSpent)) {
                        currentUser.totalSpent = 0;
                    }
                    currentUser.totalSpent += grandTotal;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));

                    // 2. C·∫≠p nh·∫≠t m·∫£ng 'users' (b·∫°n ƒë√£ c√≥ code n√†y)
                    let users = JSON.parse(localStorage.getItem('users')) || [];
                    let userIndex = users.findIndex(u => u.email === currentUser.email);
                    if (userIndex > -1) {
                        users[userIndex].totalSpent = currentUser.totalSpent;
                        localStorage.setItem('users', JSON.stringify(users));
                    }

                    // 3. (M·ªöI) T·∫°o ƒë·ªëi t∆∞·ª£ng ƒë∆°n h√†ng
                    const newOrder = {
                        orderId: orderId,
                        date: orderDate,
                        total: grandTotal,
                        userEmail: currentUser.email, // G·∫Øn ƒë∆°n h√†ng v·ªõi email ng∆∞·ªùi d√πng
                        items: currentCart // L∆∞u l·∫°i c√°c s·∫£n ph·∫©m ƒë√£ mua
                    };

                    // 4. (M·ªöI) L·∫•y l·ªãch s·ª≠ c≈©, th√™m ƒë∆°n m·ªõi, v√† l∆∞u l·∫°i
                    let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
                    orderHistory.push(newOrder);
                    localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
                }


                // ƒê·ªï d·ªØ li·ªáu v√†o trang x√°c nh·∫≠n
                document.getElementById('conf-order-id').innerText = '#' + Math.floor(100000 + Math.random() * 900000);
                // ... (code c√≤n l·∫°i c·ªßa b·∫°n) ...

                // X√≥a gi·ªè h√†ng v√† voucher
                localStorage.removeItem('cart');
                // ...

                const customerName = document.getElementById('hoTen').value;
                const customerPhone = document.getElementById('sdt').value;
                const customerNotes = document.getElementById('ghiChu').value;
                let customerAddress = '';
                if (tinhThanhSelect.value === 'other') {
                    customerAddress = document.getElementById('manualAddress').value;
                } else {
                    const diaChi = document.getElementById('diaChi').value;
                    const phuongXa = phuongXaSelect.options[phuongXaSelect.selectedIndex].text;
                    const quanHuyen = quanHuyenSelect.options[quanHuyenSelect.selectedIndex].text;
                    const tinhThanh = tinhThanhSelect.options[tinhThanhSelect.selectedIndex].text;
                    customerAddress = `${diaChi}, ${phuongXa}, ${quanHuyen}, ${tinhThanh}`;
                }
                const paymentMethod = document.getElementById('cod').checked ? 'Thanh to√°n ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng' : 'Chuy·ªÉn kho·∫£n ng√¢n h√†ng';

                // ƒê·ªï d·ªØ li·ªáu v√†o trang x√°c nh·∫≠n
                document.getElementById('conf-order-id').innerText = '#' + Math.floor(100000 + Math.random() * 900000);
                document.getElementById('conf-order-date').innerText = new Date().toLocaleDateString('vi-VN');
                document.getElementById('conf-order-total').innerText = formatVND(grandTotal);
                document.getElementById('conf-order-payment').innerText = paymentMethod;

                confSubtotal.innerText = formatVND(subtotal);
                confDiscount.innerText = `- ${formatVND(finalDiscount)}`;
                confShipping.innerText = formatVND(finalShipping);
                confGrandTotal.innerText = formatVND(grandTotal);

                document.getElementById('conf-customer-name').innerText = customerName;
                document.getElementById('conf-customer-phone').innerText = customerPhone;
                document.getElementById('conf-customer-address').innerText = customerAddress;
                document.getElementById('conf-customer-notes').innerText = customerNotes || 'Kh√¥ng c√≥';

                confProductList.innerHTML = '';
                cart.forEach(item => {
                    confProductList.innerHTML += `
                        <tr>
                            <td class="product-name">${item.name} <span class="text-muted">&times; ${item.quantity}</span></td>
                            <td class="price text-right">${formatVND(item.price * item.quantity)}</td>
                        </tr>
                    `;
                });

                // X√≥a gi·ªè h√†ng v√† voucher
                localStorage.removeItem('cart');
                currentDiscountVoucherCode = '';
                currentShippingVoucherCode = '';
            });

            // =======================================================
            // 8. KH·ªûI T·∫†O KHI T·∫¢I TRANG (Gi·ªØ nguy√™n)
            // =======================================================
            document.addEventListener('DOMContentLoaded', () => {
                cartPage.style.display = 'block';
                checkoutPage.style.display = 'none';
                orderConfirmationPage.style.display = 'none';

                step1Li.classList.add('completed', 'active');
                step1Num.classList.add('active');
                step2Li.classList.remove('completed', 'active');
                step2Num.classList.remove('active');
                step3Li.classList.remove('completed', 'active');
                step3Num.classList.remove('active');

                renderCart();
                updateDistrictOptions();

                // G·∫Øn s·ª± ki·ªán cho c√°c n√∫t voucher
                cartApplyPromoBtn.addEventListener('click', () => applyPromoCode(cartPromoInput, cartPromoError, cartPromoSuccess));
                checkoutApplyPromoBtn.addEventListener('click', () => applyPromoCode(checkoutPromoInput, checkoutPromoError, checkoutPromoSuccess));

                // G·∫Øn s·ª± ki·ªán cho dropdown ƒë·ªãa ch·ªâ
                tinhThanhSelect.addEventListener('change', updateDistrictOptions);
                quanHuyenSelect.addEventListener('change', updateWardOptions);

                // G·∫Øn s·ª± ki·ªán cho n√∫t ch·ªçn payment
                document.querySelectorAll('.payment-method').forEach(el => {
                    el.addEventListener('click', () => {
                        document.querySelector('.payment-method.active').classList.remove('active');
                        el.classList.add('active');
                        el.querySelector('input[type="radio"]').checked = true;
                    });
                });
            });
            src = "JavaScript/global.js"
        </script>

        <div class="floating-contact">
            <a href="https://www.facebook.com/DhCongThuongHCM" class="float-btn facebook-btn" target="_blank" aria-label="Facebook">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a href="tel:02888883388" class="float-btn phone-btn" aria-label="G·ªçi ƒëi·ªán tho·∫°i">
                <span class="phone-icon-wrapper">
                    <i class="fas fa-phone-alt"></i>
                </span>
                <span class="phone-number">028.8888.3388</span>
            </a>
        </div>

        <div class="zalo-float-btn">
            <a href="https://zalo.me/g/zdxrse918" target="_blank" aria-label="Chat Zalo">
                <img src="/Home Page/img/7044033_zalo_icon.png" alt="Zalo Icon">
            </a>
        </div>

        <footer class="mt-5 pt-5 pb-3" style="background-color: #1e2d40; color: #a9b3c1;">
            <div class="container">
                <div class="row">
                    <div class="col-md-5">
                        <h6 class="text-white">C√îNG TY TNHH SWEETIE CAKE</h6>
                        <p class="small">140 L√™ Tr·ªçng T·∫•n, ph∆∞·ªùng T√¢y Th·∫°nh, Qu·∫≠n T√¢n Ph√∫, TP.HCM</p>
                        <p class="small">Gi·∫•y ch·ª©ng nh·∫≠n ƒêKKD: 0315630862 do S·ªü K·∫ø ho·∫°ch v√† ƒê·∫ßu t∆∞ TP.HCM c·∫•p l·∫ßn ƒë·∫ßu ng√†y 16/04/2019.</p>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-white">CH√çNH S√ÅCH</h6>
                        <ul class="list-unstyled">
                            <li><a href="/4menu/BTap nh√≥m thi·∫øt k·∫ø web/btap/giaohang.html" class="small" style="color: #a9b3c1;">Ch√≠nh s√°ch giao h√†ng</a></li>
                            <li><a href="/4menu/BTap nh√≥m thi·∫øt k·∫ø web/btap/lienhe.html" class="small" style="color: #a9b3c1;">Th√¥ng tin li√™n h·ªá</a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 text-center">
                        <img src="/Home Page/img/logoSaleNoti.png" alt="ƒê√£ Th√¥ng B√°o B·ªô C√¥ng Th∆∞∆°ng" style="width: 150px;">
                    </div>
                </div>
                <hr style="border-color: #3a4b60;">
                <div class="text-center small">
                    <p>&copy; 2025 Sweetie Cake. All Rights Reserved. (ƒê·ªì √°n c·ªßa nh√≥m)</p>
                </div>
            </div>
        </footer>
    </body>
</html>